### Context Memory Examples
### This file demonstrates API Contexts - maintaining consistency across related requests

@baseUrl = http://localhost:5116

###############################################################################
### BASIC CONTEXT USAGE
###############################################################################

### Example 1: Basic Context - Query Parameter
### First request in a context
GET {{baseUrl}}/api/mock/users?context=demo-session
X-Response-Shape: {"id": 0, "name": "string", "email": "string"}

### Second request in same context
### Notice how the LLM will maintain consistency with the previous user
GET {{baseUrl}}/api/mock/users?context=demo-session
X-Response-Shape: {"id": 0, "name": "string", "email": "string"}

###

### Example 2: Context via Header
GET {{baseUrl}}/api/mock/products/123
X-Api-Context: demo-session
X-Response-Shape: {"productId": 0, "name": "string", "price": 0.0}

###

### Example 3: Context via Request Body
POST {{baseUrl}}/api/mock/orders
Content-Type: application/json

{
  "context": "demo-session",
  "shape": {
    "orderId": 0,
    "userId": 0,
    "total": 0.0
  }
}

###############################################################################
### E-COMMERCE FLOW - Multi-Step Consistent Journey
###############################################################################

### Step 1: Create a new user
POST {{baseUrl}}/api/mock/users?context=ecommerce-flow-001
Content-Type: application/json

{
  "shape": {
    "userId": 0,
    "name": "string",
    "email": "string",
    "address": {
      "street": "string",
      "city": "string",
      "zipCode": "string"
    },
    "phone": "string"
  }
}

### Step 2: Browse products (will reference the user context)
GET {{baseUrl}}/api/mock/products?context=ecommerce-flow-001&limit=3
X-Response-Shape: [{"productId": 0, "name": "string", "price": 0.0, "category": "string"}]

### Step 3: Add items to cart (will use same userId from step 1)
POST {{baseUrl}}/api/mock/cart?context=ecommerce-flow-001
Content-Type: application/json

{
  "shape": {
    "cartId": 0,
    "userId": 0,
    "items": [
      {
        "productId": 0,
        "name": "string",
        "quantity": 0,
        "price": 0.0
      }
    ],
    "subtotal": 0.0
  }
}

### Step 4: Create order (will reference userId and cartId from previous steps)
POST {{baseUrl}}/api/mock/orders?context=ecommerce-flow-001
Content-Type: application/json

{
  "shape": {
    "orderId": 0,
    "userId": 0,
    "cartId": 0,
    "items": [],
    "total": 0.0,
    "shippingAddress": {
      "street": "string",
      "city": "string",
      "zipCode": "string"
    },
    "status": "string"
  }
}

### Step 5: Process payment (will use orderId and userId from context)
POST {{baseUrl}}/api/mock/payments?context=ecommerce-flow-001
Content-Type: application/json

{
  "shape": {
    "paymentId": 0,
    "orderId": 0,
    "userId": 0,
    "amount": 0.0,
    "method": "string",
    "status": "string",
    "timestamp": "string"
  }
}

### Step 6: Confirm shipment (references all previous data)
POST {{baseUrl}}/api/mock/shipments?context=ecommerce-flow-001
Content-Type: application/json

{
  "shape": {
    "shipmentId": 0,
    "orderId": 0,
    "userId": 0,
    "trackingNumber": "string",
    "carrier": "string",
    "estimatedDelivery": "string",
    "status": "string"
  }
}

###############################################################################
### STOCK TICKER - Realistic Price Variance
###############################################################################

### First call - Establish baseline stock prices
GET {{baseUrl}}/api/mock/stocks?context=market-session-001
X-Response-Shape: [
  {
    "symbol": "string",
    "name": "string",
    "price": 0.0,
    "change": 0.0,
    "changePercent": 0.0,
    "volume": 0,
    "timestamp": "string"
  }
]

### Wait a moment, then call again - prices will change realistically
### Same stocks, but prices move up/down gradually (not random jumps)
GET {{baseUrl}}/api/mock/stocks?context=market-session-001
X-Response-Shape: [
  {
    "symbol": "string",
    "name": "string",
    "price": 0.0,
    "change": 0.0,
    "changePercent": 0.0,
    "volume": 0,
    "timestamp": "string"
  }
]

### Third call - Continues the trend
GET {{baseUrl}}/api/mock/stocks?context=market-session-001
X-Response-Shape: [
  {
    "symbol": "string",
    "name": "string",
    "price": 0.0,
    "change": 0.0,
    "changePercent": 0.0,
    "volume": 0,
    "timestamp": "string"
  }
]

###############################################################################
### GAME STATE PROGRESSION
###############################################################################

### Start new game session
POST {{baseUrl}}/api/mock/game/start?context=game-session-abc123
Content-Type: application/json

{
  "shape": {
    "playerId": 0,
    "playerName": "string",
    "level": 0,
    "health": 0,
    "maxHealth": 0,
    "experience": 0,
    "gold": 0,
    "inventory": [],
    "location": "string"
  }
}

### Complete a quest - level and stats should increase
POST {{baseUrl}}/api/mock/game/quest/complete?context=game-session-abc123
Content-Type: application/json

{
  "shape": {
    "playerId": 0,
    "questId": 0,
    "questName": "string",
    "experienceGained": 0,
    "goldReward": 0,
    "itemReward": {
      "itemId": 0,
      "name": "string",
      "type": "string",
      "rarity": "string"
    },
    "newLevel": 0,
    "newExperience": 0,
    "newGold": 0
  }
}

### Battle encounter - health decreases, experience increases
POST {{baseUrl}}/api/mock/game/battle?context=game-session-abc123
Content-Type: application/json

{
  "shape": {
    "playerId": 0,
    "enemyName": "string",
    "damageTaken": 0,
    "damageDealt": 0,
    "experienceGained": 0,
    "lootDropped": [],
    "currentHealth": 0,
    "victory": true
  }
}

### Use healing item - health restored
POST {{baseUrl}}/api/mock/game/heal?context=game-session-abc123
Content-Type: application/json

{
  "shape": {
    "playerId": 0,
    "itemUsed": "string",
    "healthRestored": 0,
    "currentHealth": 0,
    "maxHealth": 0
  }
}

### Check player stats - should reflect all previous actions
GET {{baseUrl}}/api/mock/game/player?context=game-session-abc123
X-Response-Shape: {
  "playerId": 0,
  "playerName": "string",
  "level": 0,
  "health": 0,
  "maxHealth": 0,
  "experience": 0,
  "gold": 0,
  "inventory": [],
  "questsCompleted": 0,
  "enemiesDefeated": 0,
  "location": "string"
}

###############################################################################
### GRAPHQL WITH CONTEXT
###############################################################################

### Create user via GraphQL
POST {{baseUrl}}/api/mock/graphql?context=graphql-session-001
Content-Type: application/json

{
  "query": "mutation CreateUser { createUser(name: \"Alice\", email: \"alice@example.com\") { id name email createdAt } }"
}

### Query user - will maintain consistency with created user
POST {{baseUrl}}/api/mock/graphql?context=graphql-session-001
Content-Type: application/json

{
  "query": "query GetUser($id: ID!) { user(id: $id) { id name email posts { id title content likes } } }",
  "variables": {
    "id": "1"
  }
}

### Create post for user - userId will be consistent
POST {{baseUrl}}/api/mock/graphql?context=graphql-session-001
Content-Type: application/json

{
  "query": "mutation CreatePost { createPost(userId: 1, title: \"My First Post\", content: \"Hello World\") { id title content author { id name } createdAt } }"
}

###############################################################################
### STREAMING WITH CONTEXT
###############################################################################

### First streaming call - establishes baseline data
GET {{baseUrl}}/api/mock/stream/sensor-data?context=iot-session-001
Accept: text/event-stream
X-Response-Shape: {
  "sensorId": "string",
  "temperature": 0.0,
  "humidity": 0.0,
  "timestamp": "string"
}

### Second streaming call - data will show realistic changes
GET {{baseUrl}}/api/mock/stream/sensor-data?context=iot-session-001
Accept: text/event-stream
X-Response-Shape: {
  "sensorId": "string",
  "temperature": 0.0,
  "humidity": 0.0,
  "timestamp": "string"
}

###############################################################################
### SOCIAL MEDIA SIMULATION
###############################################################################

### Create user profile
POST {{baseUrl}}/api/mock/social/users?context=social-app-001
Content-Type: application/json

{
  "shape": {
    "userId": 0,
    "username": "string",
    "displayName": "string",
    "bio": "string",
    "followers": 0,
    "following": 0,
    "postsCount": 0
  }
}

### Create post by user
POST {{baseUrl}}/api/mock/social/posts?context=social-app-001
Content-Type: application/json

{
  "shape": {
    "postId": 0,
    "userId": 0,
    "username": "string",
    "content": "string",
    "likes": 0,
    "comments": 0,
    "shares": 0,
    "timestamp": "string"
  }
}

### Add comment to post
POST {{baseUrl}}/api/mock/social/comments?context=social-app-001
Content-Type: application/json

{
  "shape": {
    "commentId": 0,
    "postId": 0,
    "userId": 0,
    "username": "string",
    "content": "string",
    "likes": 0,
    "timestamp": "string"
  }
}

### Get user feed - shows consistent userId, usernames, postIds
GET {{baseUrl}}/api/mock/social/feed?context=social-app-001
X-Response-Shape: [
  {
    "postId": 0,
    "userId": 0,
    "username": "string",
    "content": "string",
    "likes": 0,
    "comments": 0,
    "timestamp": "string"
  }
]

###############################################################################
### BOOKING SYSTEM
###############################################################################

### Search available hotels
GET {{baseUrl}}/api/mock/hotels/search?context=booking-001&city=Paris&checkin=2025-06-01&checkout=2025-06-05
X-Response-Shape: [
  {
    "hotelId": 0,
    "name": "string",
    "city": "string",
    "rating": 0.0,
    "pricePerNight": 0.0,
    "availability": true,
    "amenities": []
  }
]

### Get hotel details - will reference hotels from search
GET {{baseUrl}}/api/mock/hotels/123?context=booking-001
X-Response-Shape: {
  "hotelId": 0,
  "name": "string",
  "description": "string",
  "city": "string",
  "address": "string",
  "rating": 0.0,
  "pricePerNight": 0.0,
  "rooms": [],
  "amenities": [],
  "photos": []
}

### Create booking - will use hotelId from previous calls
POST {{baseUrl}}/api/mock/bookings?context=booking-001
Content-Type: application/json

{
  "shape": {
    "bookingId": 0,
    "hotelId": 0,
    "hotelName": "string",
    "guestName": "string",
    "guestEmail": "string",
    "checkinDate": "string",
    "checkoutDate": "string",
    "numberOfGuests": 0,
    "roomType": "string",
    "totalPrice": 0.0,
    "status": "string"
  }
}

### Payment for booking - references bookingId and total from previous step
POST {{baseUrl}}/api/mock/payments/booking?context=booking-001
Content-Type: application/json

{
  "shape": {
    "paymentId": 0,
    "bookingId": 0,
    "amount": 0.0,
    "currency": "string",
    "method": "string",
    "status": "string",
    "confirmationNumber": "string"
  }
}

###############################################################################
### API CONTEXT MANAGEMENT API
### Programmatically view and modify context history
###############################################################################

### List all API contexts (summary view)
GET {{baseUrl}}/api/contexts
Accept: application/json

###

### Get specific context with full details (all calls and shared data)
GET {{baseUrl}}/api/contexts/demo-session
Accept: application/json

###

### Get specific context (limit call history to last 10)
GET {{baseUrl}}/api/contexts/ecommerce-flow-001?maxCalls=10
Accept: application/json

###

### Get context summary only (no call details)
GET {{baseUrl}}/api/contexts/demo-session?includeCallDetails=false
Accept: application/json

###

### Get the formatted prompt text for a context (what LLM sees)
GET {{baseUrl}}/api/contexts/demo-session/prompt
Accept: application/json

###

### Manually add a call to a context
# Useful for pre-populating context data or testing
POST {{baseUrl}}/api/contexts/test-context/calls
Content-Type: application/json
Accept: application/json

{
  "method": "GET",
  "path": "/api/mock/products/123",
  "requestBody": null,
  "responseBody": "{\"id\": \"123\", \"name\": \"Widget\", \"price\": 29.99}"
}

###

### Add multiple calls to build context history
POST {{baseUrl}}/api/contexts/test-context/calls
Content-Type: application/json

{
  "method": "POST",
  "path": "/api/mock/cart",
  "requestBody": "{\"productId\": \"123\", \"quantity\": 2}",
  "responseBody": "{\"cartId\": \"cart-456\", \"items\": [{\"productId\": \"123\", \"quantity\": 2}], \"total\": 59.98}"
}

###

### Update shared data for a context
# Shared data is automatically extracted but can be manually set/updated
PATCH {{baseUrl}}/api/contexts/test-context/shared-data
Content-Type: application/json
Accept: application/json

{
  "userId": "user-789",
  "cartId": "cart-456",
  "sessionToken": "token-abc123"
}

###

### Clear a specific context (removes all calls, starts fresh)
POST {{baseUrl}}/api/contexts/demo-session/clear
Accept: application/json

###

### Delete a specific context completely
DELETE {{baseUrl}}/api/contexts/demo-session
Accept: application/json

###

### Clear all API contexts
DELETE {{baseUrl}}/api/contexts
Accept: application/json

###

### Complete management workflow example
### Step 1: View all contexts
GET {{baseUrl}}/api/contexts

### Step 2: Inspect specific context
GET {{baseUrl}}/api/contexts/ecommerce-flow-001

### Step 3: View what the LLM sees for this context
GET {{baseUrl}}/api/contexts/ecommerce-flow-001/prompt

### Step 4: Manually add data to context
POST {{baseUrl}}/api/contexts/ecommerce-flow-001/calls
Content-Type: application/json

{
  "method": "GET",
  "path": "/api/mock/special-offer",
  "requestBody": null,
  "responseBody": "{\"offerId\": \"SAVE20\", \"discount\": 20, \"expiresAt\": \"2025-12-31\"}"
}

### Step 5: Update shared discount code
PATCH {{baseUrl}}/api/contexts/ecommerce-flow-001/shared-data
Content-Type: application/json

{
  "activePromoCode": "SAVE20",
  "discountPercent": 20
}

### Step 6: Make API call using updated context
POST {{baseUrl}}/api/mock/checkout?context=ecommerce-flow-001
Content-Type: application/json

{
  "shape": {
    "orderId": 0,
    "userId": 0,
    "total": 0.0,
    "discount": 0.0,
    "promoCode": "string"
  }
}

### Step 7: Clean up - delete context
DELETE {{baseUrl}}/api/contexts/ecommerce-flow-001

###

###############################################################################
### ALTERNATIVE CONTEXT PARAMETER NAME
###############################################################################

### You can use 'api-context' instead of 'context' for clarity
GET {{baseUrl}}/api/mock/users?api-context=my-session
X-Response-Shape: {"id": 0, "name": "string"}

### Works with all parameter types
POST {{baseUrl}}/api/mock/orders
Content-Type: application/json

{
  "apiContext": "my-session",
  "shape": {
    "orderId": 0,
    "total": 0.0
  }
}

###############################################################################
### MULTI-CONTEXT ISOLATION
###############################################################################

### Context 1: Session A
GET {{baseUrl}}/api/mock/users?context=session-a
X-Response-Shape: {"id": 0, "name": "string"}

### Context 2: Session B (completely independent)
GET {{baseUrl}}/api/mock/users?context=session-b
X-Response-Shape: {"id": 0, "name": "string"}

### Second call to Session A - maintains its own history
GET {{baseUrl}}/api/mock/orders?context=session-a
X-Response-Shape: {"orderId": 0, "userId": 0}

### Second call to Session B - maintains its own separate history
GET {{baseUrl}}/api/mock/orders?context=session-b
X-Response-Shape: {"orderId": 0, "userId": 0}

###

### NOTES:
### - Contexts are case-insensitive: "Session-A" and "session-a" are the same
### - Contexts persist in memory until cleared or server restarts
### - Each context tracks up to 15 recent calls (older calls are summarized)
### - Shared data (IDs, names, emails) is automatically extracted
### - LLM uses context history to maintain consistency
### - Works with REST, Streaming, GraphQL, and SignalR endpoints

###############################################################################
### ERROR SIMULATION
### Test error handling without modifying server code
###############################################################################

###
### QUERY PARAMETER ERRORS
###

### Simple 404 error (default message)
GET {{baseUrl}}/api/mock/users/999?error=404

### 401 Unauthorized with custom message
GET {{baseUrl}}/api/mock/users?error=401&errorMessage=Invalid authentication token

### 500 Internal Server Error with message and details
GET {{baseUrl}}/api/mock/orders?error=500&errorMessage=Database connection failed&errorDetails=Connection timeout after 30 seconds

### 400 Bad Request
POST {{baseUrl}}/api/mock/users?error=400&errorMessage=Invalid request payload
Content-Type: application/json

{
  "name": "Test User"
}

### 403 Forbidden
GET {{baseUrl}}/api/mock/admin/users?error=403&errorMessage=Insufficient permissions

### 429 Too Many Requests
GET {{baseUrl}}/api/mock/api/rate-limit?error=429&errorMessage=Rate limit exceeded&errorDetails=Try again in 60 seconds

### 503 Service Unavailable
GET {{baseUrl}}/api/mock/external/service?error=503&errorMessage=Service temporarily unavailable

###
### HEADER-BASED ERRORS
###

### 404 via header
GET {{baseUrl}}/api/mock/products/999
X-Error-Code: 404
X-Error-Message: Product not found

### 401 via header
GET {{baseUrl}}/api/mock/secure/data
X-Error-Code: 401
X-Error-Message: Authentication required
X-Error-Details: Please provide a valid API key

### 500 via header
POST {{baseUrl}}/api/mock/orders
Content-Type: application/json
X-Error-Code: 500
X-Error-Message: Payment processing failed

{
  "orderId": 123,
  "total": 99.99
}

###
### SHAPE JSON ERRORS
###

### Simple error in shape (404)
GET {{baseUrl}}/api/mock/users/123
X-Response-Shape: {"$error": 404}

### Complex error in shape with message and details
GET {{baseUrl}}/api/mock/payments/456
X-Response-Shape: {
  "$error": {
    "code": 402,
    "message": "Payment required",
    "details": "Subscription has expired"
  }
}

### Error with shape - shape is sanitized (error returned, shape ignored)
POST {{baseUrl}}/api/mock/orders
Content-Type: application/json

{
  "shape": {
    "$error": {
      "code": 503,
      "message": "Service maintenance",
      "details": "System will be back online at 10:00 AM"
    },
    "orderId": 0,
    "status": "string"
  }
}

###
### BODY JSON ERRORS
###

### Simple error in body
POST {{baseUrl}}/api/mock/users
Content-Type: application/json

{
  "error": 409,
  "name": "John Doe",
  "email": "john@example.com"
}

### Complex error in body
POST {{baseUrl}}/api/mock/bookings
Content-Type: application/json

{
  "error": {
    "code": 422,
    "message": "Validation failed",
    "details": "Check-in date must be in the future"
  },
  "hotelId": 123,
  "checkinDate": "2025-01-01"
}

###
### GRAPHQL ERRORS
###

### Simple GraphQL error
POST {{baseUrl}}/api/mock/graphql?error=404&errorMessage=Query not found
Content-Type: application/json

{
  "query": "query { user(id: 999) { id name email } }"
}

### GraphQL authentication error
POST {{baseUrl}}/api/mock/graphql
Content-Type: application/json
X-Error-Code: 401
X-Error-Message: Unauthorized access

{
  "query": "mutation { deleteUser(id: 123) { success } }"
}

### GraphQL error via body
POST {{baseUrl}}/api/mock/graphql
Content-Type: application/json

{
  "query": "query { posts { id title } }",
  "error": {
    "code": 500,
    "message": "Internal server error",
    "details": "Database query timeout"
  }
}

###
### STREAMING ERRORS
###

### Streaming endpoint with error (SSE format)
GET {{baseUrl}}/api/mock/stream/sensor-data?error=503&errorMessage=Sensor offline
Accept: text/event-stream

### Streaming error via header
GET {{baseUrl}}/api/mock/stream/live-feed
Accept: text/event-stream
X-Error-Code: 429
X-Error-Message: Rate limit exceeded
X-Error-Details: Maximum 10 connections per client

###
### ERROR PRECEDENCE EXAMPLES
### Query params > Headers > Shape JSON > Body JSON
###

### Query param overrides header
GET {{baseUrl}}/api/mock/test1?error=404
X-Error-Code: 500
# Result: 404 (query param wins)

### Header overrides shape
GET {{baseUrl}}/api/mock/test2
X-Error-Code: 401
X-Response-Shape: {"$error": 500}
# Result: 401 (header wins)

### Shape overrides body
POST {{baseUrl}}/api/mock/test3
Content-Type: application/json

{
  "shape": {"$error": 403},
  "error": 500
}
# Result: 403 (shape wins)

###
### COMMON ERROR CODES REFERENCE
###

### 400 Bad Request - Invalid syntax
GET {{baseUrl}}/api/mock/validation?error=400&errorMessage=Missing required field: email

### 401 Unauthorized - Authentication needed
GET {{baseUrl}}/api/mock/profile?error=401&errorMessage=Please login to continue

### 403 Forbidden - No permission
GET {{baseUrl}}/api/mock/admin?error=403&errorMessage=Admin access required

### 404 Not Found - Resource doesn't exist
GET {{baseUrl}}/api/mock/users/99999?error=404&errorMessage=User not found

### 405 Method Not Allowed - Wrong HTTP method
POST {{baseUrl}}/api/mock/readonly?error=405&errorMessage=POST method not allowed

### 408 Request Timeout - Request took too long
GET {{baseUrl}}/api/mock/slow-query?error=408&errorMessage=Request timeout

### 409 Conflict - Resource conflict
POST {{baseUrl}}/api/mock/users?error=409&errorMessage=Email already exists

### 422 Unprocessable Entity - Validation failed
POST {{baseUrl}}/api/mock/orders?error=422&errorMessage=Invalid payment method

### 429 Too Many Requests - Rate limiting
GET {{baseUrl}}/api/mock/api?error=429&errorMessage=Rate limit: 100 requests per minute

### 500 Internal Server Error - Server error
GET {{baseUrl}}/api/mock/crash?error=500&errorMessage=Unexpected server error

### 501 Not Implemented - Feature not available
GET {{baseUrl}}/api/mock/beta-feature?error=501&errorMessage=Feature coming soon

### 502 Bad Gateway - Upstream error
GET {{baseUrl}}/api/mock/proxy?error=502&errorMessage=Upstream service error

### 503 Service Unavailable - Maintenance
GET {{baseUrl}}/api/mock/maintenance?error=503&errorMessage=Scheduled maintenance

### 504 Gateway Timeout - Upstream timeout
GET {{baseUrl}}/api/mock/external?error=504&errorMessage=Upstream service timeout

###
### ERRORS WITH CONTEXT
### Test error handling in contextual flows
###

### Simulate failed authentication in flow
GET {{baseUrl}}/api/mock/login?context=error-flow-001&error=401&errorMessage=Invalid credentials

### Simulate resource not found
GET {{baseUrl}}/api/mock/users/999?context=error-flow-001&error=404&errorMessage=User not found

### Retry with successful request (no error param)
GET {{baseUrl}}/api/mock/users/1?context=error-flow-001
X-Response-Shape: {"id": 0, "name": "string", "email": "string"}

###
### MIXED SUCCESS AND ERROR SCENARIOS
###

### Step 1: Successful user creation
POST {{baseUrl}}/api/mock/users?context=mixed-flow-001
Content-Type: application/json

{
  "shape": {
    "userId": 0,
    "name": "string",
    "email": "string"
  }
}

### Step 2: Failed order (payment error)
POST {{baseUrl}}/api/mock/orders?context=mixed-flow-001&error=402&errorMessage=Payment method declined
Content-Type: application/json

{
  "shape": {
    "orderId": 0,
    "userId": 0,
    "total": 0.0
  }
}

### Step 3: Retry with updated payment (success)
POST {{baseUrl}}/api/mock/orders?context=mixed-flow-001
Content-Type: application/json

{
  "shape": {
    "orderId": 0,
    "userId": 0,
    "total": 0.0,
    "status": "string"
  }
}

###
### ERROR SIMULATION NOTES:
### - Errors bypass LLM generation for faster responses
### - HTTP status code is set on the response
### - Error format: {"error": {"code": 404, "message": "...", "details": "..."}}
### - GraphQL errors use GraphQL format: {"errors": [...], "data": null}
### - Streaming errors return SSE format: data: {"error": {...}}
### - Precedence: Query params > Headers > Shape JSON > Body JSON
### - Works with all endpoint types: REST, Streaming, GraphQL, SignalR
### - $error hints are removed from shape before LLM prompt generation
### - Combine with contexts to test error recovery flows
###
